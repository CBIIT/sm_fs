<div class="row">
  <ng-container *ngIf="true then singleSource else multiSource"></ng-container>
  <ng-template #singleSource>
    <div class="col-12">

      <h2>Applications Proposed for Funding</h2>

      <p><small>Please note that the Standard Policy Reduction should be taken into consideration when determining the
        recommended dollar amounts for the request. If you would like to include a waiver to the Standard Policy
        Reduction, please provide it as part of the justification. The current fiscal year's policy reductions can be
        viewed on the <a href="https://mynci.cancer.gov/topics/oefia-current-fiscal-year-funding-information"
                         target="_blank"
                         class="external-link">OEFIA web site</a>.</small></p>

      <div class="d-flex mb-2">
        <button
          type="button"
          [disabled]="!canAddFundingSource()"
          class="btn btn-primary ml-auto"
          data-toggle="modal"
          data-target="#add-FS-modal"
          (click)="onAddFundingSource()">
          <i class="fas fa-plus mr-1" aria-hidden="true"></i> Add Funding Source
        </button>
      </div>

      <table class="table table-bordered table-striped app-funding-table">
        <thead>
        <tr>
          <th scope="col">Grant Information</th>
          <th scope="col">
            <label [attr.for]="'FundSrc- + index'">
              Funding Source
              <a href="#"><i class="fas fa-question-circle" aria-hidden="true"></i></a>
            </label>
            <app-fp-funding-source [parentForm]="parentForm" [index]="0"></app-fp-funding-source>
          </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let grant of listGrantsSelected; let i = index;" [ngModelGroup]="grant.fullGrantNum">
          <td>
            <app-fp-grant-information
              [parentForm]="parentForm"
              [grantIndex]="i"
              [grant]="grant"
              [sourceIndex]="0">
            </app-fp-grant-information>
          </td>
          <td>
            <app-fp-program-recommended-costs
              [parentForm]="parentForm"
              [grantIndex]="i"
              [grant]="grant"
              [sourceIndex]="0">
            </app-fp-program-recommended-costs>
          </td>

        </tr>

        </tbody>
        <tfoot>
        <tr>
          <td scope="row"><strong>Total Recommended Costs</strong></td>
          <td>
            <div class="form-row">
              <div class="col-lg-6">
                <span class="like-label">Direct Cost</span>
                <span>{{ sourceSumDirectCost(0) | currency }}</span>
              </div>
              <div class="col-lg-6">
                <span class="like-label">Total Cost</span>
                <span>{{ sourceSumTotalCost(0) | currency }}</span>
              </div>
            </div>
          </td>
        </tr>
        </tfoot>
      </table>
    </div>
  </ng-template>
  <ng-template #multiSource>
    <div class="col-12 mb-5">

      <h2>Applications Proposed for Funding</h2>

      <p><small>The Standard Policy Reduction should be taken into consideration when determining the recommended dollar amounts for the funding selection plan. If you would like to include a waiver to the Standard Policy Reduction, please provide it as part of the justification. The current fiscal year's policy reductions can be viewed on the <a href="https://mynci.cancer.gov/topics/oefia-current-fiscal-year-funding-information" target="_blank"
                                                                                                                                                                                                                                                                                                                                                             class="external-link">OEFIA web site</a>.</small></p>

      <div class="d-flex mb-2">
        <button type="button" class="btn btn-primary ml-auto" data-toggle="modal" data-target="#add-FS-modal"><i class="fas fa-plus mr-1" aria-hidden="true"></i> Add Funding Source</button>
      </div>

      <div class="table-responsive">

        <table class="table table-bordered table-striped app-funding-table multiple-FS">
          <thead>
          <tr>
            <th scope="col">Grant Information</th>
            <th colspan="2">
              <div class="d-flex align-items-center">
                <span>DCB Discretionary RPG Funds</span>
                <button type="button" class="btn btn-sm btn-slim btn-link ml-2" ngbTooltip="Edit" placement="left">
                  <i class="fas fa-pencil" aria-hidden="true"></i>
                </button>
                <button type="button" class="btn btn-sm btn-slim btn-link btn-link-danger ml-1" ngbTooltip="Remove" placement="left">
                  <i class="fas fa-trash" aria-hidden="true"></i>
                </button>
              </div>
            </th>
            <th colspan="2">
              <div class="d-flex align-items-center">
                <span>Pool RPG Funds</span>
                <button type="button" class="btn btn-sm btn-slim btn-link ml-2" ngbTooltip="Edit" placement="left">
                  <i class="fas fa-pencil" aria-hidden="true"></i>
                </button>
                <button type="button" class="btn btn-sm btn-slim btn-link btn-link-danger ml-1" ngbTooltip="Remove" placement="left">
                  <i class="fas fa-trash" aria-hidden="true"></i>
                </button>
              </div>
            </th>
            <th colspan="2">
              <div class="d-flex align-items-center">
                <span>Another One</span>
                <button type="button" class="btn btn-sm btn-slim btn-link ml-2" ngbTooltip="Edit" placement="left">
                  <i class="fas fa-pencil" aria-hidden="true"></i>
                </button>
                <button type="button" class="btn btn-sm btn-slim btn-link btn-link-danger ml-1" ngbTooltip="Remove" placement="left">
                  <i class="fas fa-trash" aria-hidden="true"></i>
                </button>
              </div>
            </th>
            <th scope="col"  colspan="2">Total Recommended Costs</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td>

              <!-- ======================================== START GRANT INFO WRAPPER ======================================== -->

              <div class="grant-info-wrapper">

                <a class="btn btn-link grant-info-toggle-btn" data-toggle="collapse" href="#row-collapse-3" role="button" aria-expanded="false" aria-controls="row-collapse-3" ngbTooltip="Collapse Grant Information" placement="top" target="_blank"></a>

                <div class="grant-info-row">
                  <div class="grant-info-col">
                    <span class="like-label mb-0">Grant Number</span>
                    <div class="d-flex align-items-center">
                      <a href="#">1R01CA253860-01A1</a>
                      <div class="grant-icons ml-1">
                        <a href="#" target="yourgrant" ngbTooltip="eGrants">
                          <span class="egrants-icon"></span>
                        </a>
                        <a href="">
                          <i class='fa fa-university' aria-hidden='true'></i>
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="grant-info-col">
                    <span class="like-label mb-0">PI</span>
                    <span><a href="#">Vance, Caeser</a></span>
                  </div>

                  <div class="grant-info-col">
                    <span class="like-label mb-0">PI Requested&nbsp;DC</span>
                    <span>$100,000</span>
                  </div>

                  <div class="grant-info-col">
                    <span class="like-label mb-0">PI Requested&nbsp;TC</span>
                    <span>$550,000</span>
                  </div>

                  <div class="grant-info-col">
                    <label for="rec-fy-3">Recommended Future Years</label>
                    <select class="form-control" id="rec-fy-3">
                      <option></option>
                      <option>1</option>
                      <option>2</option>
                    </select>
                  </div>

                </div>

                <div class="collapse" id="row-collapse-3">

                  <div class="grant-info-row">
                    <div class="grant-info-col">
                      <span class="like-label mb-0">Project Title</span>
                      <span>Integrative Analysis of the Human Tumor Immunity</span>
                    </div>

                    <div class="grant-info-col">
                      <span class="like-label mb-0">FOA</span>
                      <span><a href="#">PAR19-263</a></span>
                    </div>

                    <div class="grant-info-col">
                      <span class="like-label mb-0">Score</span>
                      <span>25</span>
                    </div>

                    <div class="grant-info-col">
                      <span class="like-label mb-0">NCAB Date</span>
                      <span>10/2021</span>
                    </div>
                  </div>

                </div>

              </div>

              <!-- ======================================== END GRANT INFO WRAPPER ======================================== -->

            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00
            </td>

          </tr>

          <tr>
            <td>

              <!-- ======================================== START GRANT INFO WRAPPER ======================================== -->

              <div class="grant-info-wrapper">

                <a class="btn btn-link grant-info-toggle-btn" data-toggle="collapse" href="#row-collapse-3" role="button" aria-expanded="false" aria-controls="row-collapse-3" ngbTooltip="Collapse Grant Information" placement="top"></a>

                <div class="grant-info-row">
                  <div class="grant-info-col">
                    <span class="like-label mb-0">Grant Number</span>
                    <div class="d-flex align-items-center">
                      <a href="#">1R01CA253860-01A1</a>
                      <div class="grant-icons ml-1">
                        <a href="#" target="yourgrant" ngbTooltip="eGrants">
                          <span class="egrants-icon"></span>
                        </a>
                        <a href="">
                          <i class='fa fa-university' aria-hidden='true'></i>
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="grant-info-col">
                    <span class="like-label mb-0">PI</span>
                    <span><a href="#">Vance, Caeser</a></span>
                  </div>

                  <div class="grant-info-col">
                    <span class="like-label mb-0">PI Requested&nbsp;DC</span>
                    <span>$100,000</span>
                  </div>

                  <div class="grant-info-col">
                    <span class="like-label mb-0">PI Requested&nbsp;TC</span>
                    <span>$550,000</span>
                  </div>

                  <div class="grant-info-col">
                    <label for="rec-fy-3">Recommended Future Years</label>
                    <select class="form-control" id="rec-fy-3">
                      <option></option>
                      <option>1</option>
                      <option>2</option>
                    </select>
                  </div>

                </div>

                <div class="collapse" id="row-collapse-3">

                  <div class="grant-info-row">
                    <div class="grant-info-col">
                      <span class="like-label mb-0">Project Title</span>
                      <span>Integrative Analysis of the Human Tumor Immunity</span>
                    </div>

                    <div class="grant-info-col">
                      <span class="like-label mb-0">FOA</span>
                      <span><a href="#">PAR19-263</a></span>
                    </div>

                    <div class="grant-info-col">
                      <span class="like-label mb-0">Score</span>
                      <span>25</span>
                    </div>

                    <div class="grant-info-col">
                      <span class="like-label mb-0">NCAB Date</span>
                      <span>10/2021</span>
                    </div>
                  </div>

                </div>

              </div>

              <!-- ======================================== END GRANT INFO WRAPPER ======================================== -->

            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00<br/>
              80% Cut
            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00
            </td>

          </tr>

          </tbody>

          <tfoot>
          <tr>
            <td scope="row"><strong>Total Recommended Costs</strong></td>
            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00
            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00
            </td>

            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00
            </td>
            <td>
              <strong>Direct</strong><br/>
              $1,000,000.00
            </td>

            <td>
              <strong>Total</strong><br/>
              $1,000,000.00
            </td>
          </tr>
          </tfoot>

        </table>

      </div>

    </div>
  </ng-template>

  <div class="col-12">
    <div class="form-group">
      <label for="funding-comments">Comments <span class="optional">(optional)</span></label>
      <textarea id="funding-comments" #funding_comments name="fundingComments" maxlength="2000" class="form-control"
                rows="2" [(ngModel)]="comments"></textarea>
      <span class="character-counter">{{ funding_comments.value.length }}/2000</span>
    </div>
  </div>

  <div class="col-12">
    <hr>
  </div>
</div>


<div class="modal fade" id="add-FS-modal" tabindex="-1" role="dialog"
     aria-labelledby="add-FS-modal-title" aria-hidden="true">
  <form #modalForm="ngForm" (ngSubmit)="onModalSubmit($event)">
    <div class="modal-dialog modal-dialog-scrollable modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title" id="add-FS-modal-title">Add Funding Source</span>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- START Modal Body -->

          <table class="table table-bordered table-striped app-funding-table">
            <thead>
            <tr>
              <th scope="col">Grant Information</th>
              <th scope="col">
                <label for="FundSrc-1">
                  Funding Source
                  <a href="#" (click)="openFsDetails()"><i class="fas fa-question-circle" aria-hidden="true"></i></a>
                </label>
                <app-fp-funding-source
                    #modalFpFundingSource
                    [parentForm]="modalForm"
                    [index]="sourceIndex">
                </app-fp-funding-source>
              </th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let grant of listGrantsSelected; let i = index;">
              <td>
                <app-fp-grant-information
                    #modalFpGrantInformation
                    [isModal]="true"
                    [sourceIndex]="sourceIndex"
                    [grantIndex]="i"
                    [grant]="grant">
                </app-fp-grant-information>
              </td>
              <td>
                <app-fp-program-recommended-costs
                    #modalFpRecommendedCosts
                    [sourceIndex]="sourceIndex"
                    [grantIndex]="i">
                </app-fp-program-recommended-costs>
              </td>

            </tr>

            </tbody>

            <tfoot>
            <tr>
              <td scope="row"><strong>Total Recommended Costs</strong></td>
              <td>
                <div class="form-row">
                  <div class="col-lg-6">
                    <span class="like-label">Direct Cost</span>
                    <span>$0.00</span>
                  </div>
                  <div class="col-lg-6">
                    <span class="like-label">Total Cost</span>
                    <span>$0.00</span>
                  </div>
                </div>
              </td>
            </tr>
            </tfoot>

          </table>

          <!-- END Modal Body-->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary mr-auto" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">Add Funding Source</button>
        </div>
      </div>
    </div>
  </form>
</div>
